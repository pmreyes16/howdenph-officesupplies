import{r as h,af as B,ag as X,ah as Q,j as e,ai as H,aj as Y,ak as Z,al as $,am as K,an as A,ao as W}from"./vendor-Bz9mgt4P.js";import{R as G,A as ee,B as I,I as D,T as te,a as re,b as se,c as ne}from"./components-BEGhyFtX.js";import"./index-DM-qLYKU.js";(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))c(a);new MutationObserver(a=>{for(const l of a)if(l.type==="childList")for(const m of l.addedNodes)m.tagName==="LINK"&&m.rel==="modulepreload"&&c(m)}).observe(document,{childList:!0,subtree:!0});function o(a){const l={};return a.integrity&&(l.integrity=a.integrity),a.referrerPolicy&&(l.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?l.credentials="include":a.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function c(a){if(a.ep)return;a.ep=!0;const l=o(a);fetch(a.href,l)}})();function be(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function we(t){if(Object.prototype.hasOwnProperty.call(t,"__esModule"))return t;var n=t.default;if(typeof n=="function"){var o=function c(){var a=!1;try{a=this instanceof c}catch{}return a?Reflect.construct(n,arguments,this.constructor):n.apply(this,arguments)};o.prototype=n.prototype}else o={};return Object.defineProperty(o,"__esModule",{value:!0}),Object.keys(t).forEach(function(c){var a=Object.getOwnPropertyDescriptor(t,c);Object.defineProperty(o,c,a.get?a:{enumerable:!0,get:function(){return t[c]}})}),o}const oe=1,ae=1e6;let P=0;function ie(){return P=(P+1)%Number.MAX_SAFE_INTEGER,P.toString()}const C=new Map,k=t=>{if(C.has(t))return;const n=setTimeout(()=>{C.delete(t),q({type:"REMOVE_TOAST",toastId:t})},ae);C.set(t,n)},ce=(t,n)=>{switch(n.type){case"ADD_TOAST":return{...t,toasts:[n.toast,...t.toasts].slice(0,oe)};case"UPDATE_TOAST":return{...t,toasts:t.toasts.map(o=>o.id===n.toast.id?{...o,...n.toast}:o)};case"DISMISS_TOAST":{const{toastId:o}=n;return o?k(o):t.toasts.forEach(c=>{k(c.id)}),{...t,toasts:t.toasts.map(c=>c.id===o||o===void 0?{...c,open:!1}:c)}}case"REMOVE_TOAST":return n.toastId===void 0?{...t,toasts:[]}:{...t,toasts:t.toasts.filter(o=>o.id!==n.toastId)}}},R=[];let _={toasts:[]};function q(t){_=ce(_,t),R.forEach(n=>{n(_)})}function le({...t}){const n=ie(),o=a=>q({type:"UPDATE_TOAST",toast:{...a,id:n}}),c=()=>q({type:"DISMISS_TOAST",toastId:n});return q({type:"ADD_TOAST",toast:{...t,id:n,open:!0,onOpenChange:a=>{a||c()}}}),{id:n,dismiss:c,update:o}}function Ie(){const[t,n]=h.useState(_);return h.useEffect(()=>(R.push(n),()=>{const o=R.indexOf(n);o>-1&&R.splice(o,1)}),[t]),{...t,toast:le,dismiss:o=>q({type:"DISMISS_TOAST",toastId:o})}}function Ee(...t){return B(X(t))}const de="modulepreload",ue=function(t){return"/"+t},L={},Ne=function(n,o,c){let a=Promise.resolve();if(o&&o.length>0){let E=function(f){return Promise.all(f.map(g=>Promise.resolve(g).then(w=>({status:"fulfilled",value:w}),w=>({status:"rejected",reason:w}))))};document.getElementsByTagName("link");const m=document.querySelector("meta[property=csp-nonce]"),x=m?.nonce||m?.getAttribute("nonce");a=E(o.map(f=>{if(f=ue(f),f in L)return;L[f]=!0;const g=f.endsWith(".css"),w=g?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${f}"]${w}`))return;const S=document.createElement("link");if(S.rel=g?"stylesheet":de,g||(S.as="script"),S.crossOrigin="",S.href=f,x&&S.setAttribute("nonce",x),document.head.appendChild(S),g)return new Promise((N,T)=>{S.addEventListener("load",N),S.addEventListener("error",()=>T(new Error(`Unable to preload CSS for ${f}`)))})}))}function l(m){const x=new Event("vite:preloadError",{cancelable:!0});if(x.payload=m,window.dispatchEvent(x),!x.defaultPrevented)throw m}return a.then(m=>{for(const x of m||[])x.status==="rejected"&&l(x.reason);return n().catch(l)})},me="https://qcsdytspmmnqwdrwoiuj.supabase.co",fe="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InFjc2R5dHNwbW1ucXdkcndvaXVqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTQ3Mjc3MTksImV4cCI6MjA3MDMwMzcxOX0.TsiyC1f2VaB9RtmlAQPFlAKM5rDlWY0EJX4sZN2wFpc",p=Q(me,fe),F=h.createContext(void 0),U=[{id:"1",username:"admin",role:"admin",name:"Admin User",department:"IT"},{id:"2",username:"user1",role:"user",name:"John Doe",department:"Marketing"},{id:"3",username:"user2",role:"user",name:"Jane Smith",department:"HR"},{id:"4",username:"user3",role:"user",name:"Mike Johnson",department:"Finance"}],J=({children:t})=>{const[n,o]=h.useState(null);h.useEffect(()=>{const r=localStorage.getItem("user");r&&o(JSON.parse(r))},[]),h.useEffect(()=>{n?localStorage.setItem("user",JSON.stringify(n)):localStorage.removeItem("user")},[n]),h.useEffect(()=>{if(!n)return;let r;const s=()=>{clearTimeout(r),r=setTimeout(()=>{o(null),localStorage.removeItem("user"),alert("Logged out due to inactivity.")},120*1e3)};return window.addEventListener("mousemove",s),window.addEventListener("keydown",s),s(),()=>{clearTimeout(r),window.removeEventListener("mousemove",s),window.removeEventListener("keydown",s)}},[n]);const[c,a]=h.useState([]);h.useEffect(()=>{const r=async()=>{const{data:d,error:u}=await p.from("Inventory").select("*");u?console.error("Supabase fetch inventory error:",u.message):d&&a(d)},s=async()=>{const{data:d,error:u}=await p.from("Requests").select("*");u?console.error("Supabase fetch requests error:",u.message):d&&m(d)};r(),s()},[]);const[l,m]=h.useState([]),[x,E]=h.useState(U),f=async(r,s)=>{const d=await p.from("Inventory").select("*");!d.error&&d.data&&a(d.data);const u=await p.from("Requests").select("*");!u.error&&u.data&&m(u.data);const j=await p.from("Users").select("*").eq("email",r).eq("password",s).limit(1);j.error&&console.error("Supabase login error:",j.error.message,j.error.details),console.log("Supabase login query result:",j.data);const y=j.data&&j.data[0];if(y)return o({id:y.id,username:y.email,role:y.role,name:y.name,department:y.department||""}),p.from("auth.audit_log_entries").insert([{event_type:"login",user_id:y.id,username:y.email,timestamp:new Date().toISOString(),details:"User logged in successfully."}]),!0;console.warn("No matching user found in Supabase for:",r);const v=U.find(O=>O.username===r&&s==="password");return v?(o(v),p.from("auth.audit_log_entries").insert([{event_type:"login",user_id:v.id,username:v.username,timestamp:new Date().toISOString(),details:"Mock user logged in."}]),!0):!1},g=()=>{o(null),localStorage.removeItem("user")},w=r=>{const s={...r,id:Date.now().toString()};"minStock"in s&&(s.minstock=Number(s.minStock),delete s.minStock),a(d=>[...d,s]),p.from("Inventory").insert([s])},S=(r,s)=>{"minStock"in s&&(s.minstock=Number(s.minStock),delete s.minStock),a(d=>d.map(u=>u.id===r?{...u,...s}:u)),p.from("Inventory").update(s).eq("id",r)},N=r=>{a(s=>s.filter(d=>d.id!==r)),p.from("Inventory").delete().eq("id",r)},T=(r,s,d)=>{(async()=>{if(!n)return;const u=c.find(v=>v.id===r);if(!u)return;const j={id:Date.now().toString(),userId:n.id,userName:n.name,department:n.department,itemId:r,itemName:u.name,quantity:s,status:"pending",requestDate:new Date().toISOString().split("T")[0],notes:d};m(v=>[...v,j]);const{error:y}=await p.from("Requests").insert([j]);y&&console.error("Supabase request insert error:",y.message)})()},i=(r,s)=>{const d=s==="denied"||s==="fulfilled"||s==="approved";p.from("Requests").update({status:s,archived:d}).eq("id",r).then(async()=>{const{data:u}=await p.from("Requests").select("*");if(u&&m(u),s==="approved"||s==="fulfilled"){const j=u?.find(y=>y.id===r);if(j){const{data:y}=await p.from("Inventory").select("*").eq("id",j.itemId),v=y&&y[0];if(v){const O=Math.max(0,v.quantity-j.quantity);await p.from("Inventory").update({quantity:O}).eq("id",v.id),a(z=>z.map(M=>M.id===v.id?{...M,quantity:O}:M))}}}})},b=async r=>{E(d=>[...d,{id:r.id,username:r.email,name:r.name,department:r.department,role:r.role,password:r.password,email:r.email}]);const{error:s}=await p.from("Users").insert([{id:r.id,name:r.name,email:r.email,role:r.role,password:r.password,department:r.department}]);if(s)throw new Error(s.message)};return e.jsx(F.Provider,{value:{user:n,inventory:c,requests:l,login:f,logout:g,addItem:w,updateItem:S,deleteItem:N,createRequest:T,updateRequest:i,addUser:b},children:t})},Te=()=>{const t=h.useContext(F);if(!t)throw new Error("useApp must be used within AppProvider");return t},V=()=>e.jsx(J,{children:e.jsx("div",{className:"p-4 max-w-4xl mx-auto",children:e.jsx(G,{})})}),pe=()=>window.location.pathname==="/request-history"?e.jsx(V,{}):e.jsx(J,{children:e.jsx(ee,{})}),he=()=>{const t=H();return h.useEffect(()=>{console.error("404 Error: User attempted to access non-existent route:",t.pathname)},[t.pathname]),e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-background",children:e.jsxs("div",{className:"text-center p-8 rounded-lg border border-border bg-card shadow-md animate-slide-in",children:[e.jsx("h1",{className:"text-5xl font-bold mb-6 text-primary",children:"404"}),e.jsx("p",{className:"text-xl text-card-foreground mb-6",children:"Page not found"}),e.jsx("a",{href:"/",className:"text-primary hover:text-primary/80 underline transition-colors",children:"Return to Home"})]})})},ye=()=>{const[t,n]=h.useState([]),[o,c]=h.useState(null),[a,l]=h.useState({}),[m,x]=h.useState(null),[E,f]=h.useState(!1),g=async()=>{f(!0);const{data:i,error:b}=await p.from("Users").select("*");console.log("Fetched users:",i),b?x(b.message):n(i||[]),f(!1)};h.useEffect(()=>{g()},[]);const w=i=>{c(i.id),l({name:i.name,email:i.email,role:i.role,department:i.department})},S=()=>{c(null),l({})},N=async i=>{f(!0);const{error:b}=await p.from("Users").update(a).eq("id",i);b?x(b.message):(c(null),l({}),g()),f(!1)},T=async i=>{if(!window.confirm("Are you sure you want to delete this user?"))return;f(!0);const{error:b}=await p.from("Users").delete().eq("id",i);b?x(b.message):g(),f(!1)};return e.jsxs("div",{className:"max-w-2xl mx-auto py-8",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("button",{type:"button",className:"px-4 py-2 bg-gray-200 rounded hover:bg-gray-300 text-sm",onClick:()=>window.history.back(),children:"← Back"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(I,{onClick:g,variant:"outline",children:"View Users"}),e.jsx("a",{href:"/request-history",children:e.jsx(I,{variant:"outline",children:"View History"})})]})]}),e.jsx("h1",{className:"text-2xl font-bold mb-4",children:"User Management"}),m&&e.jsx("div",{className:"text-red-600 mb-2",children:m}),E&&e.jsx("div",{className:"text-gray-500 mb-2",children:"Loading..."}),e.jsxs("table",{className:"w-full border mb-4",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gray-100",children:[e.jsx("th",{className:"p-2 border",children:"Name"}),e.jsx("th",{className:"p-2 border",children:"Email"}),e.jsx("th",{className:"p-2 border",children:"Role"}),e.jsx("th",{className:"p-2 border",children:"Department"}),e.jsx("th",{className:"p-2 border",children:"Actions"})]})}),e.jsx("tbody",{children:t.map((i,b)=>e.jsxs("tr",{children:[e.jsx("td",{className:"border p-2",children:o===i.id?e.jsx(D,{value:a.name||"",onChange:r=>l(s=>({...s,name:r.target.value}))}):i.name||i.email||i.username||"-"}),e.jsx("td",{className:"border p-2",children:o===i.id?e.jsx(D,{value:a.email||"",onChange:r=>l(s=>({...s,email:r.target.value}))}):i.email||i.username||i.name||"-"}),e.jsx("td",{className:"border p-2",children:o===i.id?e.jsxs("select",{value:a.role||"",onChange:r=>l(s=>({...s,role:r.target.value})),className:"border rounded px-2 py-1",children:[e.jsx("option",{value:"user",children:"Standard User"}),e.jsx("option",{value:"admin",children:"Admin"})]}):i.role}),e.jsx("td",{className:"border p-2",children:i.department||"-"}),e.jsx("td",{className:"border p-2",children:o===i.id?e.jsxs(e.Fragment,{children:[e.jsx(I,{size:"sm",onClick:()=>N(i.id),className:"mr-2",children:"Save"}),e.jsx(I,{size:"sm",variant:"outline",onClick:S,children:"Cancel"})]}):e.jsxs(e.Fragment,{children:[e.jsx(I,{size:"sm",onClick:()=>w(i),className:"mr-2",children:"Edit"}),e.jsx(I,{size:"sm",variant:"destructive",onClick:()=>T(i.id),children:"Delete"})]})})]},i.id||i.email||b))})]})]})},xe=new Y,ge=()=>e.jsx(te,{defaultTheme:"light",children:e.jsx(Z,{client:xe,children:e.jsxs(re,{children:[e.jsx(se,{}),e.jsx(ne,{}),e.jsx($,{children:e.jsxs(K,{children:[e.jsx(A,{path:"/",element:e.jsx(pe,{})}),e.jsx(A,{path:"/users",element:e.jsx(ye,{})}),e.jsx(A,{path:"/request-history",element:e.jsx(V,{})}),e.jsx(A,{path:"*",element:e.jsx(he,{})})]})})]})})});W.createRoot(document.getElementById("root")).render(e.jsx(ge,{}));export{Ne as _,Te as a,we as b,Ee as c,be as g,p as s,Ie as u};
